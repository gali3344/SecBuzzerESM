# Copyright 2001-2013 Sourcefire, Inc. All Rights Reserved.
#
# This file contains (i) proprietary rules that were created, tested and certified by
# Sourcefire, Inc. (the "VRT Certified Rules") that are distributed under the VRT
# Certified Rules License Agreement (v 2.0), and (ii) rules that were created by
# Sourcefire and other third parties (the "GPL Rules") that are distributed under the
# GNU General Public License (GPL), v2.
#
# The VRT Certified Rules are owned by Sourcefire, Inc. The GPL Rules were created
# by Sourcefire and other third parties. The GPL Rules created by Sourcefire are
# owned by Sourcefire, Inc., and the GPL Rules not created by Sourcefire are owned by
# their respective creators. Please see http://www.snort.org/snort/snort-team/ for a
# list of third party owners and their respective copyrights.
#
# In order to determine what rules are VRT Certified Rules or GPL Rules, please refer
# to the VRT Certified Rules License Agreement (v2.0).
#
#-------------
# LOCAL RULES
#-------------
# EXTERNAL_NET
# 

##  shellshock
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Shellshock (CVE-2014-6271)"; flow:to_server; uricontent:"|3B|"; pcre:"/\(\)\s*\{.*\;\s*\}\s*\;/U"; classtype:string-detect; reference:cve,2014-6271; sid:5000001;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Shellshock (CVE-2014-7169)"; flow:to_server; uricontent:"|3D|"; uricontent:"|3B|"; pcre:"/\(\)\s*?\{.*?\(.*?\).*?=/U"; classtype:string-detect; reference:cve,2014-7169; sid:5000002;)

## SQL
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - MySQL information disclosure 'mysql.user'"; flow:to_server; uricontent:"|6D 79 73 71 6C|"; nocase; uricontent:"|75 73 65 72|"; nocase; pcre:"/mysql.*?\..*?user/iU"; classtype:string-detect; sid:5000003;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - SQLite information disclosure 'sqlite_master'"; flow:to_server; uricontent:"|73 71 6C 69 74 65 5F 6D 61 73 74 65 72|"; nocase; classtype:string-detect; sid:5000004;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common MySQL function 'find_in_set'"; flow:to_server; content:"POST"; http_method; uricontent:"find_in_set"; nocase; pcre:"/find_in_set.*?\(.+?,.+?\)/iU"; classtype:string-detect; sid:5000005;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common SQL command 'union select'"; flow:to_server; content:"POST"; http_method; content:"|75 6E 69 6F 6E|"; nocase; content:"|53 45 4C 45 43 54|"; nocase; pcre:"/union\b.+?select/i"; classtype:string-detect; sid:5000006;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common SQL command 'update'"; flow:to_server; content:"POST"; http_method; content:"|75 70 64 61 74 65|"; nocase; content:"|73 65 74|"; nocase; pcre:"/update\b.+?set\b/i"; classtype:string-detect; sid:5000007;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common SQL command 'drop'"; flow:to_server; content:"POST"; http_method; content:"|64 72 6F 70|"; nocase; pcre:"/\bdrop\b.+?\b(database|table)\b/i"; classtype:string-detect; sid:5000008;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common SQL command 'delete'"; flow:to_server; content:"POST"; http_method; content:"|64 65 6C 65 74 65|"; nocase; content:"|66 72 6F 6D|"; nocase; pcre:"/\bdelete\b.+?\bfrom\b/i"; classtype:string-detect; sid:5000009;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common SQL command 'length'"; flow:to_server; content:"POST"; http_method; content:"|6C 65 6E 67 74 68|"; nocase; pcre:"/\b(char_|bit_)?length\b.*?\(.+?\)/i"; classtype:string-detect; sid:5000010;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common SQL command 'hex/unhex'"; flow:to_server; content:"POST"; http_method; content:"|68 65 78|"; nocase; pcre:"/\b(un)?hex\b.*?\(.+?\)/i"; classtype:string-detect; sid:5000011;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common SQL command 'from_base64/to_base64'"; flow:to_server; content:"POST"; http_method; content:"|5F 62 61 73 65 36 34|"; nocase; pcre:"/\b(from|to)_base64\b.*?\(.+?\)/i"; classtype:string-detect; sid:5000012;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common SQL command 'substr'"; flow:to_server; content:"POST"; http_method; content:"|73 75 62 73 74 72|"; nocase; pcre:"/\bsubstr(ing(\_index)?)?\b.*?\(.+?,.+?\)/i"; classtype:string-detect; sid:5000013;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common SQL command 'user'"; flow:to_server; content:"POST"; http_method; content:"|53 45 4C 45 43 54|"; nocase; content:"|75 73 65 72|"; nocase; pcre:"/\b(current_)?user\.*?\(.*?\)/i"; classtype:string-detect; sid:5000014;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common SQL command 'version'"; flow:to_server; content:"POST"; http_method; content:"|76 65 72 73 69 6F 6E|"; nocase; pcre:"/\bversion\b.*?\(.*?\)/i"; classtype:string-detect; sid:5000015;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common SQL command 'oct'"; flow:to_server; content:"POST"; http_method; content:"|6F 63 74|"; nocase; pcre:"/\boct.*?\(.+?\)/i"; classtype:string-detect; sid:5000016;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common SQL command 'ord'"; flow:to_server; content:"POST"; http_method; content:"|6F 72 64|"; nocase; pcre:"/\bord\b.*?\(.+?\)/i"; classtype:string-detect; sid:5000017;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common SQL command 'ascii'"; flow:to_server; content:"POST"; http_method; content:"|61 73 63 69 69|"; nocase; pcre:"/\bascii\b.*?\(.+?\)/i"; classtype:string-detect; sid:5000018;)
alert tcp $HOME_NET any <> $EXTERNAL_NET $HTTP_PORTS (msg:"WAF ALERT - Common SQL command 'bin'"; flow:to_server; content:"POST"; http_method; content:"|62 69 6E|"; nocase; pcre:"/\bbin\b.*?\(.+?\)/i"; classtype:string-detect; sid:5000019;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common SQL command 'char'"; flow:to_server; content:"POST"; http_method; content:"|63 68 61 72|"; nocase; pcre:"/\bcha?r\b.*?\(.+?\)/i"; classtype:string-detect; sid:5000020;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common SQL command 'where'"; flow:to_server; content:"POST"; http_method; content:"|77 68 65 72 65|"; nocase; pcre:"/\bwhere\b.+?(\b(not_)?(like|regexp)\b|[=<>])/i"; classtype:string-detect; sid:5000021;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common SQL command 'if'"; flow:to_server; content:"POST"; http_method; content:"|69 66|"; nocase; pcre:"/\bif.*?\(.+?\,.+?\,.+?\)/i"; classtype:string-detect; sid:5000022;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common SQL command 'ifnull'"; flow:to_server; content:"POST"; http_method; content:"|6E 75 6C 6C|"; nocase; pcre:"/\b(ifnull|nullif)\b.*?\(.+?\,.+?\)/i"; classtype:string-detect; sid:5000023;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common SQL command 'case'"; flow:to_server; content:"POST"; http_method; content:"|63 61 73 65|"; nocase; content:"|77 68 65 6E|"; nocase; content:"|65 6E 64|"; nocase; pcre:"/\bcase\b.+?\bwhen\b.+?\bend\b/i"; classtype:string-detect; sid:5000024;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common SQL command 'create'"; flow:to_server; content:"POST"; http_method; content:"|63 72 65 61 74 65|"; nocase; pcre:"/\bcreate\b.+?\b(procedure|function)\b.*?\(.*?\)/i"; classtype:string-detect; sid:5000025;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common SQL command 'insert'"; flow:to_server; content:"POST"; http_method; content:"|69 6E 73 65 72 74|"; nocase; content:"|69 6E 74 6F|"; nocase; content:"|76 61 6C 75 65 73|"; nocase; pcre:"/\binsert\b.+?\binto\b.*?\bvalues\b.*?\(.+?\)/i"; classtype:string-detect; sid:5000026;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common SQL command 'select'"; flow:to_server; content:"POST"; http_method; content:"|73 65 6C 65 63 74|"; nocase; content:"|66 72 6F 6D|"; nocase; pcre:"/\bselect\b.+?\bfrom\b/i"; classtype:string-detect; sid:5000027;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common SQL command 'database'"; flow:to_server; content:"POST"; http_method; content:"|64 61 74 61 62 61 73 65|"; nocase; pcre:"/\b(current_)?database\b.*?\(.*?\)/i"; classtype:string-detect; sid:5000028;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common SQL command 'concat'"; flow:to_server; content:"POST"; http_method; content:"|63 6F 6E 63 61 74|"; nocase; pcre:"/\b(group_)?concat(_ws)?\b.*?\(.+?\)/i"; classtype:string-detect; sid:5000029;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - MySQL information disclosure"; flow:to_server; content:"POST"; http_method; content:"|69 6E 66 6F 72 6D 61 74 69 6F 6E 5F 73 63 68 65 6D 61|"; nocase; pcre:"/\binformation_schema\b/i"; classtype:string-detect; sid:5000030;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - MySQL file disclosure 'load_file'"; flow:to_server; content:"POST"; http_method; content:"|6C 6F 61 64 5F 66 69 6C 65|"; nocase; pcre:"/\bload_file\b.*?\(.+?\)/i"; classtype:string-detect; sid:5000031;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - MySQL file disclosure 'load data'"; flow:to_server; content:"POST"; http_method; content:"|4C 4F 41 44 20 44 41 54 41|"; nocase; pcre:"/\bload\b.*?\bdata\b.*?\binfile\b.*?\binto\b.*?\btable\b/i"; classtype:string-detect; sid:5000032;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - MySQL file disclosure 'into outfile'"; flow:to_server; content:"POST"; http_method; content:"|69 6E 74 6F 20 6F 75 74 66 69 6C 65|"; nocase; pcre:"/\bselect\b.*?\binto\b.*?\b(out|dump)file\b/i"; classtype:string-detect; sid:5000033;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - PgSQL information disclosure 'pg_user'"; flow:to_server; content:"POST"; http_method; content:"|70 67 5F 75 73 65 72|"; nocase; pcre:"/\bpg_user\b/i"; classtype:string-detect; sid:5000034;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - PgSQL information disclosure 'pg_database'"; flow:to_server; content:"POST"; http_method; content:"|70 67 5F 64 61 74 61 62 61 73 65|"; nocase; pcre:"/\bpg_database\b/i"; classtype:string-detect; sid:5000035;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - PgSQL information disclosure 'pg_shadow'"; flow:to_server; content:"POST"; http_method; content:"|70 67 5F 73 68 61 64 6F 77|"; nocase; pcre:"/\bpg_shadow\b/i"; classtype:string-detect; sid:5000036;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - MSSQL code execution 'xp_cmdshell'"; flow:to_server; content:"POST"; http_method; content:"|78 70 5F 63 6D 64 73 68 65 6C 6C|"; nocase; pcre:"/\bexec\b.+?\bxp_cmdshell\b/i"; classtype:string-detect; sid:5000037;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Blind MySQL 'benchmark'"; flow:to_server; content:"POST"; http_method; content:"|62 65 6E 63 68 6D 61 72 6B|"; nocase; pcre:"/\bbenchmark\b.*?\(.+?,.+?\)/i"; classtype:string-detect; sid:5000038;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Blind SQL 'sleep'"; flow:to_server; content:"POST"; http_method; content:"|73 6C 65 65 70|"; nocase; pcre:"/\bsleep\b.*?\(.+?\)/i"; classtype:string-detect; sid:5000039;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Blind PgSQL 'pg_sleep'"; flow:to_server; content:"POST"; http_method; content:"|70 67 5F 73 6C 65 65 70|"; nocase; pcre:"/\bpg_sleep\b.*?\(.+?\)/i"; classtype:string-detect; sid:5000040;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Blind TSQL 'waitfor'"; flow:to_server; content:"POST"; http_method; content:"|77 61 69 74 66 6F 72|"; nocase; pcre:"/\bwaitfor\b.*?\b(delay|time(out)?)\b/i"; classtype:string-detect; sid:5000041;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common SQL comment syntax"; flow:to_server; content:"GET"; http_method; uricontent:"|2D|"; nocase; pcre:"/--.+?/iU"; classtype:string-detect; sid:5000042;)

## Directory traversal
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Directory traversal"; flow:to_server; pcre:"/\.\.[\/\\]/U"; classtype:string-detect; sid:5000043;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Directory traversal unicode + urlencoding"; flow:to_server; pcre:"/%(c0\.|af\.|5c\.)/iU"; classtype:string-detect; sid:5000044;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Directory traversal unicode + urlencoding"; flow:to_server; pcre:"/%c0%ae[\/\\]/iU"; classtype:string-detect; sid:5000045;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Directory traversal urlencoding"; flow:to_server; pcre:"/%2e%2e[\/\\]/iU"; classtype:string-detect; sid:5000046;)

## URI/URL
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Firefox 'firefoxurl' URI handler"; flow:to_server; content:"POST"; http_method; content:"|66 69 72 65 66 6F 78 75 72 6C|"; nocase; pcre:"/\bfirefoxurl\s*:/i"; classtype:string-detect; sid:5000047;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Firefox 'wyciwyg' URI handler"; flow:to_server; content:"POST"; http_method; content:"|77 79 63 69 77 79 67|"; nocase; pcre:"/\bwyciwyg\s*:/i"; classtype:string-detect; sid:5000048;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Data URI scheme"; flow:to_server; content:"|64 61 74 61 3A|"; nocase; pcre:"/\bdata:.*?\,/iU"; classtype:string-detect; sid:5000049;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Data URI scheme"; flow:to_server; content:"|62 61 73 65 36 34|"; nocase; pcre:"/\;base64|base64\,/iU"; classtype:string-detect; sid:5000050;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Base URL"; flow:to_server; content:"|62 61 73 65|"; nocase; pcre:"/<base\b.+?\bhref\b.+?>/iU"; classtype:string-detect; sid:5000051;)

## PHP
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Serialized PHP objects"; flow:to_server; content:"POST"; http_method; pcre:"/\{\s*\w+\s*:\s*[+-]?\s*\d+\s*:.*?\}\}/i"; classtype:string-detect; sid:5000052;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - PHP input stream"; flow:to_server; content:"GET"; http_method; uricontent:"|70 68 70|"; nocase; content:"|69 6E 70 75 74|"; nocase; distance:3; classtype:string-detect; sid:5000053;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - PHP output stream"; flow:to_server; content:"GET"; http_method; uricontent:"|70 68 70|"; nocase; content:"|6F 75 74 70 75 74|"; nocase; distance:3; classtype:string-detect; sid:5000054;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - PHP input/output stream filter"; flow:to_server; content:"GET"; http_method; uricontent:"|70 68 70|"; nocase; content:"|66 69 6C 74 65 72|"; nocase; distance:3; classtype:string-detect; sid:5000055;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - PHP input/output stream filter 'base64'"; flow:to_server; content:"GET"; http_method; uricontent:"|70 68 70|"; nocase; content:"|66 69 6C 74 65 72|"; nocase; distance:3; pcre:"/convert\.base64-(de|en)code/iU"; classtype:string-detect; sid:5000056;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - PHP input/output stream filter 'zlib'"; flow:to_server; content:"GET"; http_method; uricontent:"|70 68 70|"; nocase; content:"|66 69 6C 74 65 72|"; nocase; distance:3; pcre:"/zlib\.(de|in)flate/iU"; classtype:string-detect; sid:5000057;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - PHP opening tag"; flow:to_server; content:"GET"; http_method; pcre:"/<\?(?!xml\s)/iU"; classtype:string-detect; sid:5000058;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - PHP complex curly syntax"; flow:to_server; content:"GET"; http_method; pcre:"/\{\s*\$\s*\{.+?\}\s*\}/iU"; classtype:string-detect; sid:5000059;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Critical PHP function 'call_user_func'"; flow:to_server; content:"GET"; http_method; uricontent:"|63 61 6C 6C 5F 75 73 65 72 5F 66 75 6E 63|"; nocase;  pcre:"/\bcall_user_func\b.*?\(.+?\)/iU"; classtype:string-detect; sid:5000060;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Critical PHP function 'create_function'"; flow:to_server; content:"GET"; http_method; uricontent:"|63 72 65 61 74 65 5F 66 75 6E 63 74 69 6F 6E|"; nocase;  pcre:"/\bcreate_function\b.*?\(.+?\)/iU"; classtype:string-detect; sid:5000061;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Critical PHP function 'eval'"; flow:to_server; content:"GET"; http_method; uricontent:"|65 76 61 6C|"; nocase; pcre:"/\b\beval\b.*?(\(.+?\)|\{.+?\})/iU"; classtype:string-detect; sid:5000062;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Critical PHP function 'exec'"; flow:to_server; content:"GET"; http_method; uricontent:"|65 78 65 63|"; nocase; pcre:"/\bexec\b.*?\(.+?\)/iU"; classtype:string-detect; sid:5000063;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Critical PHP function 'fopen/fget/fread/fwrite'"; flow:to_server; content:"GET"; http_method; pcre:"/\bf(get|open|read|write)\b.*?\(.+?\)/iU"; classtype:string-detect; sid:5000064;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Critical PHP function 'file_get_contents/file_put_contents'"; flow:to_server; content:"GET"; http_method; uricontent:"|66 69 6C 65 5F|"; nocase; uricontent:"|5F 63 6F 6E 74 65 6E 74 73|"; nocase; pcre:"/\bfile_(get|put)_contents\b.*?\(.+?\)/iU"; classtype:string-detect; sid:5000065;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Critical PHP function 'move_uploaded_file'"; flow:to_server; content:"GET"; http_method; uricontent:"|6D 6F 76 65 5F 75 70 6C 6F 61 64 65 64 5F 66 69 6C 65|"; nocase; pcre:"/\bmove_uploaded_file\b.*?\(.+?\)/iU"; classtype:string-detect; sid:5000066;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Critical PHP function 'passthru'"; flow:to_server; content:"GET"; http_method; uricontent:"|70 61 73 73 74 68 72 75|"; nocase; pcre:"/\bpassthru\b.*?\(.+?\)/iU"; classtype:string-detect; sid:5000067;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Critical PHP function 'popen/proc_open'"; flow:to_server; content:"GET"; http_method; uricontent:"|6F 70 65 6E|"; nocase; pcre:"/\bp(roc_)?open\b.*?\(.+?\)/iU"; classtype:string-detect; sid:5000068;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Critical PHP function 'readfile'"; flow:to_server; content:"GET"; http_method; uricontent:"|72 65 61 64 66 69 6C 65|"; nocase; pcre:"/\breadfile\b.*?\(.+?\)/iU"; classtype:string-detect; sid:5000069;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Critical PHP function 'shell_exec'"; flow:to_server; content:"GET"; http_method; uricontent:"|73 68 65 6C 6C 5F 65 78 65 63|"; nocase; pcre:"/\bshell_exec\b.*?\(.+?\)/iU"; classtype:string-detect; sid:5000070;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Critical PHP function 'call_user_func'"; flow:to_server; content:"GET"; http_method; uricontent:"|63 61 6C 6C 5F 75 73 65 72 5F 66 75 6E 63|"; nocase; pcre:"/\bcall_user_func\b.*?\(.+?\)/iU"; classtype:string-detect; sid:5000071;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Critical PHP function 'create_function'"; flow:to_server; content:"GET"; http_method; uricontent:"|63 72 65 61 74 65 5F 66 75 6E 63 74 69 6F 6E|"; nocase; pcre:"/\bcreate_function\b.*?\(.+?\)/iU"; classtype:string-detect; sid:5000072;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Critical PHP function 'include'"; flow:to_server; content:"GET"; http_method; uricontent:"|69 6E 63 6C 75 64 65|"; nocase; pcre:"/\binclude(_once)?\b.*?\;/iU"; classtype:string-detect; sid:5000073;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Critical PHP function 'require'"; flow:to_server; content:"GET"; http_method; uricontent:"|72 65 71 75 69 72 65|"; nocase; pcre:"/\brequire(_once)?\b.*?\;/iU"; classtype:string-detect; sid:5000074;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Critical PHP function 'system'"; flow:to_server; content:"GET"; http_method; uricontent:"|73 79 73 74 65 6D|"; nocase; pcre:"/\bsystem\b.*?\(.+?\)/iU"; classtype:string-detect; sid:5000075;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Critical PHP function 'preg_match/preg_replace'"; flow:to_server; content:"GET"; http_method; uricontent:"|70 72 65 67 5F|"; nocase; pcre:"/\bpreg_(replace|match)\b.*?\(.+?\)/iU"; classtype:string-detect; sid:5000076;)

## files & environment
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common Apache files"; flow:to_server; content:"GET"; http_method; pcre:"/\.(ht(access|passwd|group))|(apache|httpd)\d?\.conf/iU"; classtype:string-detect; sid:5000077;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common Unix files"; flow:to_server; content:"GET"; http_method; uricontent:"|65 74 63|"; nocase; pcre:"/\/etc\/[.\/]*(passwd|shadow|master\.passwd)/iU"; classtype:string-detect; sid:5000078;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common Windows files"; flow:to_server; content:"GET"; http_method; pcre:"/(?<!\w)(boot\.ini|global\.asa|sam)\b/iU"; classtype:string-detect; sid:5000079;)

## XML/HTML/CSS/JS
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - HTML event handler"; flow:to_server; content:"GET"; http_method; uricontent:"|6F 6E|"; nocase; pcre:"/\bon\w+\s*=/iU"; classtype:string-detect; sid:5000080;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - HTML escaped character"; flow:to_server; content:"GET"; http_method; uricontent:"|3B|"; nocase; pcre:"/\&\#?(\w+)\;/iU"; classtype:string-detect; sid:5000081;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - HTML breaking"; flow:to_server; content:"GET"; http_method; uricontent:"|3E|"; pcre:"/[\"\'].*?>/iU"; classtype:string-detect; sid:5000082;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - HTML breaking"; flow:to_server; content:"POST"; http_method; content:"|23|"; nocase; content:"|3E|"; nocase; pcre:"/#.+?\)[\"\s]*>/i"; classtype:string-detect; sid:5000083;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - HTML breaking"; flow:to_server; pcre:"/[\'\"][\,\;\s]+\w*[\[\(]/i"; classtype:string-detect; sid:5000084;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - HTML breaking"; flow:to_server; pcre:"/\>.*?\<\s*\/?[\w\s]+\>/i"; classtype:string-detect; sid:5000085;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Flask curly syntax"; flow:to_server; content:"GET"; http_method; uricontent:"|7B|"; uricontent:"|7D|"; pcre:"/\{\{.*?\}\}/U"; classtype:string-detect; sid:5000086;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - XML comment syntax"; flow:to_server; content:"POST"; http_method; pcre:"/<!-.+?-->/i"; classtype:string-detect; sid:5000087;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - XML entity injections"; flow:to_server; content:"POST"; http_method; pcre:"/<\!(element|entity|\[CDATA)/i"; classtype:string-detect; sid:5000088;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common concatenation pattern"; flow:to_server; content:"POST"; http_method; pcre:"/=\s*\w+\s*\+\s*['"]/i"; classtype:string-detect; sid:5000089;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common concatenation pattern"; flow:to_server; content:"POST"; http_method; pcre:"/\+=\s*\(\s*['"]/i"; classtype:string-detect; sid:5000090;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common concatenation pattern"; flow:to_server; content:"POST"; http_method; pcre:"/['"]\s*\+\s*['"]/i"; classtype:string-detect; sid:5000091;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - CSS 'import'"; flow:to_server; content:"POST"; http_method; content:"|69 6D 70 6F 72 74|"; nocase; pcre:"/@import\b/i"; classtype:string-detect; sid:5000092;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - CSS pointer to resource"; flow:to_server; content:"POST"; http_method; pcre:"/\burl\s*\(.+?\)/i"; classtype:string-detect; sid:5000093;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - jQuery selector"; flow:to_server; content:"POST"; http_method; content:"|24|"; nocase; pcre:"/\$\(.+?\)/i"; classtype:string-detect; sid:5000094;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - JavaScript language construct"; flow:to_server; content:"POST"; http_method; pcre:"/\)\s*\[/i"; classtype:string-detect; sid:5000095;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - JavaScript 'location.hash'"; flow:to_server; content:"POST"; http_method; content:"|6C 6F 63 61 74 69 6F 6E|"; nocase; content:"|68 61 73 68|"; nocase; pcre:"/\blocation\b.*?\..*?\bhash\b/i"; classtype:string-detect; sid:5000096;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common JavaScript injection points (media)"; flow:to_server; content:"POST"; http_method; pcre:"/<(applet|object|embed|audio|video|img|svg)/i"; classtype:string-detect; sid:5000097;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common JavaScript injection points (links)"; flow:to_server; content:"POST"; http_method; pcre:"/<a\b.+?\bhref\b/i"; classtype:string-detect; sid:5000098;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common JavaScript injection points (forms)"; flow:to_server; content:"POST"; http_method; pcre:"/<(form|button|input|keygen|textarea|select|option)/i"; classtype:string-detect; sid:5000099;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Common JavaScript injection points"; flow:to_server; content:"POST"; http_method; pcre:"/<(html|body|meta|link|i?frame|script|map)/i"; classtype:string-detect; sid:5000100;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - JavaScript attribute 'document'"; flow:to_server; content:"POST"; http_method; content:"|64 6F 63 75 6D 65 6E 74|"; nocase; pcre:"/\bdocument\b.*?\./i"; classtype:string-detect; sid:5000101;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - JavaScript attribute 'window'"; flow:to_server; content:"POST"; http_method; content:"|77 69 6E 64 6F 77|"; nocase; pcre:"/\bwindow\b.*?\./i"; classtype:string-detect; sid:5000102;)

## misc
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - C-style loops"; flow:to_server; content:"GET"; http_method; pcre:"/(\b(do|while|for)\b.*?\([^)]*\).*?\{)|(\}.*?\b(do|while|for)\b.*?\([^)]*\))/iU"; classtype:string-detect; sid:5000103;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - C-style ternary operator"; flow:to_server; content:"GET"; http_method; pcre:"/[=(].+?\?.+?:/iU"; classtype:string-detect; sid:5000104;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Octal entity"; flow:to_server; content:"GET"; http_method; uricontent:"|5C 5C 75 30 30|"; nocase; pcre:"/u00[a-f0-9]{2}/iU"; classtype:string-detect; sid:5000105;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Hex entity"; flow:to_server; content:"GET"; http_method; uricontent:"|5C 5C 78 30|"; nocase; pcre:"/x0[a-f0-9]{2}/iU"; classtype:string-detect; sid:5000106;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Self-contained payload"; flow:to_server; content:"GET"; http_method; uricontent:"|77 69 74 68|"; nocase; pcre:"/\bwith\b\s*\(.+?\)[\s\w]+\(/iU"; classtype:string-detect; sid:5000107;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Local file inclusion"; flow:to_server; content:"GET"; http_method; uricontent:"|3A|"; nocase; pcre:"/\b(chrome|file):/iU";   content:"|2F 2F|"; distance:0 ;classtype:string-detect; sid:5000108;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Perl command injection"; flow:to_server; content:"GET"; http_method; uricontent:"|7C|"; nocase; pcre:"/^(\s*)\||\|(\s*)$/iU"; classtype:string-detect; sid:5000109;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Apache server-side include"; flow:to_server; content:"POST"; http_method; content:"|3C 21 2D 2D|"; nocase; pcre:"/<!--\W*?#\W*?(cmd|echo|exec|include|printenv)\b/i"; classtype:string-detect; sid:5000110;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - LDAP"; flow:to_server; content:"GET"; http_method; uricontent:"|7C 28|"; nocase; pcre:"/\|\(\w+=/i"; classtype:string-detect; sid:5000111;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"WAF ALERT - Conditional compilation token"; flow:to_server; content:"GET"; http_method; uricontent:"|40|"; nocase; pcre:"/@(cc_on|set)\b/i"; classtype:string-detect; sid:5000112;)
